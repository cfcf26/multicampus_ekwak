## Streamlit 대시보드 구현 계획 (서울교통공사 지하철 혼잡도)

### 0) 개요
- **데이터**: `서울교통공사_지하철혼잡도정보_20250930.csv`
- **레코드 단위(행)**: `요일구분` × `호선` × `역번호` × `출발역` × `상하구분`별 30분 단위 혼잡도 값
- **시간 컬럼**: `5시30분` ~ `00시30분` (30분 간격)
- **목표**: “언제/어디가 가장 붐비는가?”를 빠르게 찾고, 요일·호선·역·방향별 혼잡 패턴을 비교/탐색

---

### 1) 선행 확정 사항(지표/해석)
대시보드의 정확도를 위해 아래를 먼저 정의한다.

- **혼잡도 값의 의미**
  - 단위(%)인지, 지수/혼잡도 지표인지
  - 100 초과(예: 125.6)가 가능해 보이므로, **100 초과의 의미**를 문서화
- **0.0 처리 규칙**
  - 실제 0(완전 여유)인지, 결측/집계없음/미운행인지
  - 대시보드에서 0.0을 “데이터 없음”으로 치환할지 여부
- **시간 컬럼의 집계 구간**
  - “5시30분”이 (05:30~06:00) 평균/최대/특정 기준 중 무엇인지
- **방향(`상하구분`) 해석**
  - 호선별로 `상선/하선`, `내선/외선` 등이 섞이므로 UI에서의 표기/설명 방식

---

### 2) 페이즈 단위 구현 계획

#### 페이즈 0: 요구사항 고정 (반나절~1일)
- **핵심 질문 3~5개 확정**
  - 예: (1) 최대 혼잡 역/시간은? (2) 출근/퇴근 피크는 언제? (3) 호선별 Top-N은?
- **피크 구간 정의**(초기값)
  - 예: 출근 07:00~09:00, 퇴근 18:00~20:00 (필요 시 변경 가능하도록 UI 제공)
- **색상 구간(혼잡도 등급) 정의**
  - 예시: 0~30 여유 / 30~60 보통 / 60~100 혼잡 / 100+ 매우 혼잡 (실제 기준 확정 후 적용)

산출물
- 대시보드 요구사항(1p)
- 혼잡도/0.0/시간 구간 정의(1p)

---

#### 페이즈 1: 데이터 준비/정제 (1~2일)
목표: 대시보드에 바로 쓰기 좋은 “롱 포맷(행)” 테이블로 변환하고, 결측/타입 이슈를 제거.

작업
- CSV 로드(인코딩 확인) 및 컬럼 정리
- 시간 컬럼 unpivot(가로→세로)
  - 변환 후 컬럼 예: `weekday, line, station_id, station_name, direction, time_slot, congestion`
- 숫자 파싱
  - 값에 공백이 섞여 있으므로 trim 후 float 변환
- 결측/0.0 처리(페이즈 0에서 확정한 규칙 적용)
- 시간 정렬용 키 생성
  - `time_slot`(표시용) + `time_order`(정렬용, 0..n)
- 파생 컬럼(선택)
  - `hour`, `minute`, `period`(출근/퇴근/기타)

성능/재사용
- 정제 결과를 `parquet`(권장) 또는 정제 CSV로 저장해 앱 로딩을 가볍게 함

검증 체크
- 시간 슬롯 개수 일관성(예: 44개)
- 역/호선/요일/방향 조합별 row count 정상 여부

산출물
- 정제 스크립트(ETL)
- 정제 데이터 파일(예: `data_clean.parquet`)

---

#### 페이즈 2: Streamlit MVP (2~3일)
목표: 1페이지 MVP로 핵심 질문에 답할 수 있게 구성.

UI/UX 구성(권장)
- **사이드바 필터**
  - `요일구분`(단일/다중), `호선`, `출발역(역명 검색)`, `상하구분`
  - `시간대`(단일 선택) 또는 `시간 구간`(범위)
  - `피크 구간`(출근/퇴근 시간 범위 조정)
- **메인 KPI 카드**
  - 선택 조건에서 최대 혼잡도
  - 최대 혼잡 발생 시간대
  - 해당 역/호선/방향
- **차트 3종(권장: Plotly)**
  1) **히트맵**: (역 × 시간대) 혼잡도
  2) **라인 차트**: 특정 역 선택 시 시간대별 혼잡도(방향 비교 가능)
  3) **Top-N 랭킹**: 선택 시간대/피크 구간 기준 혼잡도 상위 역
- **테이블/다운로드**
  - 현재 필터 결과 미리보기
  - 결과 CSV 다운로드

기술 포인트
- `st.cache_data`로 로드/전처리/필터 결과 캐시
- 필터가 많으므로 “필터 적용” 버튼(선택)으로 재계산 횟수 제어

산출물
- `app.py`(MVP)
- 기본 차트/필터 동작

---

#### 페이즈 3: 고도화/분석 기능 (1~2주)
목표: 비교·요약·탐색 기능 강화.

기능
- **비교 모드**
  - 요일(평일 vs 토요일 vs 일요일) 비교
  - 방향(상/하·내/외) 비교
- **피크 자동 요약**
  - 역별 피크 시간(최대/상위 3개)
  - “피크 강도(최대)” vs “피크 지속(구간 평균/면적)” 2종 랭킹
- **사용성 개선**
  - 역 검색(autocomplete), 즐겨찾기, 시각화 색상/스케일 조정
  - 툴팁 강화(호선/방향/시간대/값)

(선택) 외부 데이터 결합
- 역 좌표/환승역 여부 결합 시 지도 시각화 가능

---

#### 페이즈 4: 배포/운영 (지속)
목표: 공유 가능한 서비스 형태로 안정적 운영.

- 배포 옵션
  - Streamlit Community Cloud 또는 사내/개인 서버
- 성능 최적화
  - 사전 집계 테이블(요일×호선×역×방향×시간)
  - 캐시/메모리 관리
- 데이터 확장
  - 날짜별 파일 누적 시 자동 통합(폴더 인입 → 통합 parquet)

---

### 3) 권장 프로젝트 구조(예시)
- `app.py` : Streamlit 엔트리
- `src/data.py` : 로드/정제/캐시
- `src/metrics.py` : KPI/랭킹 계산
- `src/charts.py` : Plotly 차트 함수
- `data/` : 원본/정제 데이터

---

### 4) MVP 완료 기준(체크리스트)
- 필터(요일/호선/역/방향/시간)가 정상 동작
- 히트맵/라인/Top-N 차트가 동일 필터 기준으로 일관된 값 표시
- 최대 혼잡 KPI가 차트/테이블과 일치
- 0.0/결측 처리 규칙이 화면에 반영되고, 설명(주석/도움말)이 포함
